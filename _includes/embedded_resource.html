{% comment %}
Embedded resource include for Google Slides and YouTube videos
Usage: {% include embedded_resource.html resource=resource %}
{% endcomment %}

{% assign resource = include.resource %}
{% assign url = resource.url %}
{% assign title = resource.title %}
{% assign type = resource.type %}

{% comment %} Check if URL is Google Slides {% endcomment %}
{% assign is_google_slides = false %}
{% if url contains "docs.google.com/presentation/d/" %}
  {% assign is_google_slides = true %}
{% endif %}

{% comment %} Check if URL is YouTube {% endcomment %}
{% assign is_youtube = false %}
{% if url contains "youtube.com/watch?v=" or url contains "youtu.be/" or url contains "m.youtube.com/watch?v=" %}
  {% assign is_youtube = true %}
{% endif %}

{% if is_google_slides %}
  {% comment %} Extract presentation ID from Google Slides URL {% endcomment %}
  {% assign url_parts = url | split: "/d/" %}
  {% if url_parts.size > 1 %}
    {% assign id_with_path = url_parts[1] %}
    {% assign id_part = id_with_path | split: "/edit" | first | split: "/present" | first | split: "/pub" | first | split: "?" | first %}
    {% comment %} Handle both publication IDs (2PACX-*) and document IDs {% endcomment %}
    {% if id_part contains "2PACX-" %}
      {% assign embed_url = "https://docs.google.com/presentation/d/e/" | append: id_part | append: "/pubembed?start=false&loop=false&delayms=3000" %}
    {% else %}
      {% comment %} For document IDs, try direct embed format first {% endcomment %}
      {% assign embed_url = "https://docs.google.com/presentation/d/" | append: id_part | append: "/embed?start=false&loop=false&delayms=3000" %}
    {% endif %}
    
    <li class="resource-item resource-{{ type }}">
      <div class="embed-container slides-embed">
        <iframe src="{{ embed_url }}" 
                frameborder="0" 
                allowfullscreen
                loading="lazy"
                title="{{ title | escape }}"
                class="responsive-iframe"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                referrerpolicy="strict-origin-when-cross-origin"
                sandbox="allow-scripts allow-same-origin allow-presentation">
        </iframe>
      </div>
    </li>
  {% else %}
    {% comment %} Fallback to link if URL parsing fails {% endcomment %}
    <li class="resource-item resource-{{ type }}">
      <a href="{{ url }}" target="_blank" rel="noopener noreferrer" class="resource-link">
        {{ title }}
        {% if include.resource.description %}<span class="resource-description">{{ include.resource.description }}</span>{% endif %}
      </a>
    </li>
  {% endif %}

{% elsif is_youtube %}
  {% comment %} Extract video ID from YouTube URL {% endcomment %}
  {% assign video_id = "" %}
  
  {% if url contains "youtube.com/watch?v=" or url contains "m.youtube.com/watch?v=" %}
    {% comment %} Extract from youtube.com/watch?v=ID format {% endcomment %}
    {% assign url_parts = url | split: "v=" %}
    {% if url_parts.size > 1 %}
      {% assign video_id = url_parts[1] | split: "&" | first %}
    {% endif %}
  {% elsif url contains "youtu.be/" %}
    {% comment %} Extract from youtu.be/ID format {% endcomment %}
    {% assign url_parts = url | split: "youtu.be/" %}
    {% if url_parts.size > 1 %}
      {% assign video_id = url_parts[1] | split: "?" | first | split: "&" | first %}
    {% endif %}
  {% endif %}
  
  {% if video_id != "" %}
    {% assign embed_url = "https://www.youtube-nocookie.com/embed/" | append: video_id %}
    
    <li class="resource-item resource-{{ type }}">
      <div class="embed-container video-embed">
        <iframe src="{{ embed_url }}" 
                frameborder="0"
                allowfullscreen
                loading="lazy"
                title="{{ title | escape }}"
                class="responsive-iframe"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                referrerpolicy="strict-origin-when-cross-origin"
                sandbox="allow-scripts allow-same-origin allow-presentation">
        </iframe>
      </div>
    </li>
  {% else %}
    {% comment %} Fallback to link if video ID extraction fails {% endcomment %}
    <li class="resource-item resource-{{ type }}">
      <a href="{{ url }}" target="_blank" rel="noopener noreferrer" class="resource-link">
        {{ title }}
        {% if include.resource.description %}<span class="resource-description">{{ include.resource.description }}</span>{% endif %}
      </a>
    </li>
  {% endif %}

{% else %}
  {% comment %} Non-embeddable URL - show as regular link {% endcomment %}
  <li class="resource-item resource-{{ type }}">
    <a href="{{ url }}" target="_blank" rel="noopener noreferrer" class="resource-link">
      {{ title }}
      {% if include.resource.description %}<span class="resource-description">{{ include.resource.description }}</span>{% endif %}
    </a>
  </li>
{% endif %}